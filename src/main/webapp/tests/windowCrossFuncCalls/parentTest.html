<!DOCTYPE html>
<html lang="en">
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="./hashMap.js"></script>
    <meta charset="UTF-8">
    <title>ParentTest</title>
</head>
<body onload="" onunload="cleanup()">
    <h2>Parent Window Test</h2>
    <button onclick="childFunction()">Notify Child</button>
    <BR><BR>
    <button onclick="openUserAdminWindow()">Open User Admin</button>
    <button onclick="closeUserAdminWindow()">Close User Admin</button>
 
    <BR><BR>
    <input type="checkbox" id="userAdminCB" onchange="setCbWindowStatus(this)">User Admin<BR>
  
    <script language="Javascript" type="text/javascript">
    var winMap = new HashMap();
    var userAdmin = "userAdmin";

    var newWin = null;

    function openUserAdminWindow() {
//        alert("USER ADMIN WINDOW");
        OpenWin(userAdmin);
    }

    function closeUserAdminWindow() {
//        alert("USER ADMIN WINDOW");
        CloseWin(userAdmin);
    }

    function setCbWindowStatus(cb) {
        var winId = cb.id.substring(0, cb.id.length - "CB".length);
        var cbChecked=cb.checked;
        if (cbChecked) {
            OpenWin(winId);
        }
        else {
            CloseWin(winId)
        }
    }

    function OpenWin(winId) {
        var cbWin=getWin(winId);
        cbWin.obj = window.open(cbWin.url, cbWin.target, cbWin.features);
        newWin = cbWin.obj;
        cbWin.obj.focus();
        setCheckBox(winId, true);
    }

    function CloseWin(winId) {
        var cbWin=getWin(winId);
        cbWin.obj.close();
        cbWin.obj = null;
        setCheckBox(winId, false);
    }

    function setCheckBox(checkBoxId, mode) {
//        alert("checkBoxId = "+checkBoxId + " mode ="+mode);
        var checkBox = document.getElementById(userAdmin+"CB");
	    checkBox.checked = mode;
    }
 
     function  getWin(winIdKey) {
        var win = winMap.get(winIdKey);
        if (win == null) {
            win = childWindow(winIdKey,winIdKey,"width=250, height=100",true);
            winMap.put(winIdKey,win);
        }
        return win;
    }

    function childWindow(name,target,features,replace) {
       var win      = new Object();
       win.name     = null;
       win.url      = name+".html";
       win.target   = target;
       win.features = features;
       win.replace  = replace;
       win.obj      = null;
       return win;
    }

    function childFunction() {
        newWin.focus();
        newWin.childFunction();
    }

    function parentFunction( val ) {
        alert("Parent Function val = "+val)
    }

   function cleanup() {
   }
</script>
</body>
</html>